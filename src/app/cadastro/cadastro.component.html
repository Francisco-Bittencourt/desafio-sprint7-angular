<div class="d-flex justify-content-center align-items-center min-vh-100 bg-light">
  <div class="card p-5 shadow-sm" style="max-width: 500px; width: 100%;">
    <h2 class="text-center text-primary mb-4">Página de Cadastro</h2>
    
    <form [formGroup]="cadastroForm" (ngSubmit)="onSubmit()">
      <div class="mb-3">
        <label for="name" class="form-label">Nome Completo</label>
        <input type="text" class="form-control rounded" id="name" formControlName="name" placeholder="Seu nome completo">
        <div *ngIf="cadastroForm.get('name')?.invalid && (cadastroForm.get('name')?.dirty || cadastroForm.get('name')?.touched)" class="text-danger small mt-1">
          Nome é obrigatório.
        </div>
      </div>

      <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" class="form-control rounded" id="email" formControlName="email" placeholder="seu.email@example.com">
        <div *ngIf="cadastroForm.get('email')?.invalid && (cadastroForm.get('email')?.dirty || cadastroForm.get('email')?.touched)" class="text-danger small mt-1">
          <span *ngIf="cadastroForm.get('email')?.errors?.['required']">Email é obrigatório.</span>
          <span *ngIf="cadastroForm.get('email')?.errors?.['email']">Email inválido.</span>
        </div>
      </div>

      <div class="mb-3">
        <label for="phone" class="form-label">Celular</label>
        <input type="tel" class="form-control rounded" id="phone" formControlName="phone" placeholder="(XX) XXXXX-XXXX">
        <div *ngIf="cadastroForm.get('phone')?.invalid && (cadastroForm.get('phone')?.dirty || cadastroForm.get('phone')?.touched)" class="text-danger small mt-1">
          Celular é obrigatório.
        </div>
      </div>

      <div class="mb-3">
        <label for="password" class="form-label">Senha</label>
        <div class="input-group">
          <input [type]="passwordVisible ? 'text' : 'password'" class="form-control rounded-start" id="password" formControlName="password" placeholder="Mínimo 6 caracteres">
          <button type="button" class="btn btn-outline-secondary rounded-end" (click)="togglePasswordVisibility()" aria-label="Toggle password visibility">
            <svg *ngIf="!passwordVisible" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
              <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/>
              <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/>
            </svg>
            <svg *ngIf="passwordVisible" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-slash-fill" viewBox="0 0 16 16">
              <path d="m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7.029 7.029 0 0 0 2.79-.588zM5.21 3.088A7.028 7.028 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474L5.21 3.088z"/>
              <path d="M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829l-2.83-2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12-.708.708z"/>
            </svg>
          </button>
        </div>
        <div *ngIf="cadastroForm.get('password')?.invalid && (cadastroForm.get('password')?.dirty || cadastroForm.get('password')?.touched)" class="text-danger small mt-1">
          <span *ngIf="cadastroForm.get('password')?.errors?.['required']">Senha é obrigatória.</span>
          <span *ngIf="cadastroForm.get('password')?.errors?.['minlength']">Senha deve ter no mínimo 6 caracteres.</span>
        </div>
      </div>

      <div class="mb-3">
        <label for="confirmPassword" class="form-label">Confirmar Senha</label>
        <input [type]="passwordVisible ? 'text' : 'password'" class="form-control rounded" id="confirmPassword" formControlName="confirmPassword" placeholder="Confirme sua senha">
        <div *ngIf="cadastroForm.get('confirmPassword')?.invalid && (cadastroForm.get('confirmPassword')?.dirty || cadastroForm.get('confirmPassword')?.touched)" class="text-danger small mt-1">
          <span *ngIf="cadastroForm.get('confirmPassword')?.errors?.['required']">Confirmação de senha é obrigatória.</span>
        </div>
    
        <div *ngIf="cadastroForm.errors?.['mismatch'] && (cadastroForm.get('confirmPassword')?.dirty || cadastroForm.get('confirmPassword')?.touched)" class="text-danger small mt-1">
          Senhas não conferem.
        </div>
      </div>
      
      <div class="mb-3 mt-4">
        <h6 class="text-muted">Acordo de Usuário</h6>
        <div class="form-check">
          <input type="checkbox" class="form-check-input rounded" id="termsAndConditions" [(ngModel)]="termsAndConditionsAccepted" name="termsAndConditions" [ngModelOptions]="{standalone: true}" required>
          <label class="form-check-label" for="termsAndConditions">Eu li e aceito os <a href="https://www.planalto.gov.br/ccivil_03/_ato2015-2018/2018/lei/L13709compilado.htm" target="_blank" class="text-primary text-decoration-underline">Termos e Condições</a>.</label>
        </div>
        <div class="form-check">
          <input type="checkbox" class="form-check-input rounded" id="privacyPolicy" [(ngModel)]="privacyPolicyAccepted" name="privacyPolicy" [ngModelOptions]="{standalone: true}" required>
          <label class="form-check-label" for="privacyPolicy">Li e aceito a <a href="https://www.planalto.gov.br/ccivil_03/_ato2015-2018/2018/lei/L13709compilado.htm" target="_blank" class="text-primary text-decoration-underline">Política de Privacidade</a>.</label>
        </div>
        <div *ngIf="termsError" class="text-danger small mt-2">{{ termsError }}</div>
      </div>
      <div class="d-grid gap-2">
        <button 
          *ngIf="!cadastroSuccess"
          type="submit" 
          class="btn btn-success mt-3 rounded" 
          [disabled]="cadastroForm.invalid || !termsAndConditionsAccepted || !privacyPolicyAccepted"
        >
          Cadastrar
        </button>

        <button
          *ngIf="cadastroSuccess"
          type="button"
          class="btn btn-success mt-3 rounded"
          (click)="irParaHome()" 
        >
          Ir para Home
        </button>

        <button type="button" class="btn btn-outline-secondary rounded" (click)="voltarParaLogin()">Voltar para Login</button>
      </div>
    </form>

    <div *ngIf="cadastroSuccess" class="alert alert-success text-center mt-4" role="alert">
      Olá, **<span id="registeredNameDisplay"></span>{{ registeredName }}**! Você foi cadastrado(a) com sucesso!
    </div>

    <div *ngIf="userExistsError" class="alert alert-warning mt-3 text-center" role="alert">
      {{ userExistsError }}
    </div>

    <div *ngIf="formSubmitted && !cadastroSuccess && !termsError && !userExistsError && cadastroForm.invalid" class="alert alert-danger text-center mt-4" role="alert">
      Por favor, preencha todos os campos obrigatórios corretamente.
    </div>

  </div>
</div>
